(()=>{"use strict";function e(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){e.querySelector(".".concat(t.id,"-error")).textContent="",t.classList.remove(n)}(e,t,n):function(e,t,n,r){e.querySelector(".".concat(t.id,"-error")).textContent=n,t.classList.add(r)}(e,t,t.validationMessage,n)}function t(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.removeAttribute("disabled"):t.setAttribute("disabled",!0)}function n(e,t){e.querySelector(t).setAttribute("disabled",!0)}var r=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},o=document.querySelector(".profile__edit"),c=document.querySelector(".profile__add"),u=document.querySelector(".popup_type_profile"),i=u.querySelector(".popup__form_type_profile"),a=i.querySelector(".popup__text-field_type_name"),l=i.querySelector(".popup__text-field_type_status"),s=document.querySelector(".profile__name"),d=document.querySelector(".profile__description"),p=document.querySelector(".profile__avatar-conainer"),f=document.querySelector(".popup__type_edit-avatar"),_=document.querySelector(".profile__avatar"),m=document.querySelector(".popup__text-field_type_link-picture"),h=document.querySelector(".popup__form_type_avatar"),y=document.querySelector(".elements"),v=document.querySelector("#card-blank").content,S=document.querySelector(".popup_type_add-card"),b=S.querySelector(".popup__form_type_add-card"),q=document.querySelector(".popup__type_view-card"),E=q.querySelector(".popup__picture"),L=q.querySelector(".popup__description"),k=document.querySelector(".popup__type_delete-card"),x=document.querySelector(".popup__button-delete-card"),C="popup_opened";function g(e){"Escape"===e.key&&U(document.querySelector(".".concat(C)))}function A(e){(e.target.classList.contains(C)||e.target.classList.contains("popup__close"))&&U(e.currentTarget)}function B(e){e.classList.add("popup_opened"),document.addEventListener("keydown",g),e.addEventListener("click",A)}function U(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",g),e.removeEventListener("click",A)}function T(e,t,n){e.querySelector(t).textContent=n?"Сохранение...":"Сохранить"}function D(e,t,n,o){(function(e,t){return fetch("".concat(e.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return r(e)}))})(e,t).then((function(){return n.closest(".element").remove()})).then((function(){return U(k)})).then((function(){return o.removeEventListener("click",D)}))}function P(e,t,n,o,c,u,i){var a=v.querySelector(".element").cloneNode(!0),l=a.querySelector(".element__photo"),s=a.querySelector(".element__name"),d=a.querySelector(".element__trash"),p=a.querySelector(".element__heart"),f=a.querySelector(".element__hearts-count");return l.src=t,l.setAttribute("alt",e),s.textContent=e,l.addEventListener("click",(function(){var n,r;n=e,r=t,E.src=r,E.alt=n,L.textContent=n,B(q)})),p.addEventListener("click",(function(){p.classList.contains("element__heart_active")?function(e,t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return r(e)}))}(i,u).then((function(e){return f.textContent=e.likes.length})).then((function(){return p.classList.remove("element__heart_active")})):function(e,t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers}).then((function(e){return r(e)}))}(i,u).then((function(e){return f.textContent=e.likes.length})).then((function(){return p.classList.add("element__heart_active")}))})),n.length?(f.textContent=n.length,n.find((function(e){e._id===c&&p.classList.add("element__heart_active")}))):f.textContent="0",o===c&&d.classList.remove("element__trash_disabled"),d.addEventListener("click",(function(){B(k),x.addEventListener("click",(function(){D(i,u,d,x)}))})),a}var w,N={baseUrl:"https://nomoreparties.co/v1/plus-cohort-14",headers:{authorization:"a75084ed-65ff-46b2-92ef-67cae42fb5b5","Content-Type":"application/json"}},O={formSelector:".popup__form",inputSelector:".popup__text-field",submitButtonSelector:".popup__button-save",inputErrorClass:"popup__text-field__error"};c.addEventListener("click",(function(){B(S)})),p.addEventListener("click",(function(){B(f)})),o.addEventListener("click",(function(){!function(t,r){var o=Array.from(r.querySelectorAll(t.inputSelector));r.reset(),a.value=s.textContent,l.value=d.textContent,o.forEach((function(n){e(r,n,t.inputErrorClass)})),n(r,t.submitButtonSelector)}(O,i),B(u)})),h.addEventListener("submit",(function(e){e.preventDefault(),T(h,O.submitButtonSelector,!0),function(e,t){return fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:t})}).then((function(e){return r(e)}))}(N,m.value).then((function(){return e=_,t=m.value,void(e.src=t);var e,t})).catch((function(e){return console.log(e)})).finally((function(){return T(h,O.submitButtonSelector,!1)})),U(f)})),i.addEventListener("submit",(function(e){e.preventDefault(),T(h,O.submitButtonSelector,!0),function(e,t,n){return fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return r(e)}))}(N,a.value,l.value).then((function(){var e,t;e=a.value,t=l.value,s.textContent=e,d.textContent=t})).catch((function(e){return console.log(e)})).finally((function(){return T(h,O.submitButtonSelector,!1)})),U(u)})),b.addEventListener("submit",(function(e){e.preventDefault(),T(h,O.submitButtonSelector,!0),function(e,t,n){return fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return r(e)}))}(N,document.querySelector(".popup__text-field_type_picture-name").value,document.querySelector(".popup__text-field_type_picture-link").value).then((function(e){return function(e,t,r){var o=b.querySelector(".popup__text-field_type_picture-name").value,c=b.querySelector(".popup__text-field_type_picture-link").value;y.prepend(P(o,c,0,!0,!0,t,r)),b.reset(),n(b,e.submitButtonSelector)}(O,e._id,N)})).catch((function(e){return console.log(e)})).finally((function(){return T(h,O.submitButtonSelector,!1)})),U(S)})),function(n){Array.from(document.querySelectorAll(n.formSelector)).forEach((function(r){!function(n,r,o,c){var u=Array.from(n.querySelectorAll(r)),i=n.querySelector(o);t(u,i),u.forEach((function(r){r.addEventListener("input",(function(){e(n,r,c),t(u,i)}))}))}(r,n.inputSelector,n.submitButtonSelector,n.inputErrorClass)}))}(O),function(e){return fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then((function(e){return r(e)}))}(N).then((function(e){var t,n,r,o,c,u;t=s,n=e.name,r=d,o=e.about,c=_,u=e.avatar,t.textContent=n,r.textContent=o,c.src=u,w=e._id})).catch((function(e){return console.log(e)})),function(e){return fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then((function(e){return r(e)}))}(N).then((function(e){e.forEach((function(e){!function(e,t,n,r,o,c,u){y.append(P(e,t,n,r,o,c,u))}(e.name,e.link,e.likes,e.owner._id,w,e._id,N)}))})).catch((function(e){return console.log(e)}))})();